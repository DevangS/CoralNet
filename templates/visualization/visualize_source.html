{% extends "images/base_source.html" %}
{% load thumbnail %}
{% load guardian_tags %}

{% block title %}{{ source.name }} - Visualization | CoralNet{% endblock %}

{% block media-includes %}
  {{ block.super }}
  {{ actionForm.media }}
{% endblock %}

{% block css-code %}
<style type="text/css">

fieldset.fieldset_visualization {
    margin: 0;
}

.form_item_wrapper_visualization {
    float: left;
    margin: 0 10px;
    border: 0;
}

label.label_visualization {
    width: auto;
}

.form_item_wrapper_actionform {
    float: none;
    margin: 0 10px;
    border: 0;
}

label.label_actionform {
    float: left;
    width: auto;
}

input.submitbutton_actionform {
    display: block;
}

</style>
{% endblock %}

{% block content %}

    <h2>Browse Images</h2>
    
    <!-- This is the menu to select descriptors to sort through the images -->
    <form action="" method="get">

        <fieldset class="fieldset_visualization">
          {% for field in form %}
            <div class="form_item_wrapper, form_item_wrapper_visualization" id="id_{{ field.name }}_wrapper">
                <label for="{{ field.id_for_label }}" class="label_visualization">{{ field.label }}:</label>

                <div class="field_wrapper">
                    {{ field }}
                </div>
            </div>
          {% endfor %}
        </fieldset>
        
      <div class="submit_button_wrapper">
        <input type='submit' value="Search">
      </div>
    </form>

    {% if errors %}
        <ul>
            {% for error in errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    {% else %}
        {% for image in images.object_list %}
           {% if image.metadata %}
              {% with metadata=image.metadata %}
                <span class="thumb_wrapper">
                <a href="{% url image_detail source.id image.id %}">
                    <img class="thumb"
                         src="{% thumbnail image.original_file 150x150 %}"
                         title="{{ image.get_image_element_title }}"/>
                </a>
                </span>
              {% endwith %}
            {% else %}
              {% with fullImage=image.fullImage %}
                <span class="thumb_wrapper">
                <a href="{% url image_detail source.id fullImage.id %}">
                    <img class="thumb"
                         src="{{ MEDIA_URL }}{{ image.patchPath }}"
                         title="Point {{ image.pointNum }} ({{ image.row }},{{ image.col }}) in: {{ fullImage.get_image_element_title }}"/>
                </a>
                </span>
              {% endwith %}
            {% endif %}
        {% endfor %}

        <div class="pagination">
            <span>
                Showing {{ images.start_index }}-{{ images.end_index }} of {{ images.paginator.count }}
            </span>
            <br /><br />
            <span class="step-links">
                {% if images.has_previous %}
                    <a href="?{{ searchParamsStr }}&page={{ images.previous_page_number }}">&lt;</a>
                {% endif %}

                <span class="current">
                    Page {{ images.number }} of {{ images.paginator.num_pages }}
                </span>

                {% if images.has_next %}
                    <a href="?{{ searchParamsStr }}&page={{ images.next_page_number }}">&gt;</a>
                {% endif %}
            </span>
        </div>

        {% get_obj_perms user for source as "source_perms" %}
        {% if not showPatches and "source_edit" in source_perms %}

            <form id="id_actionForm" action="?{{ searchParamsStr }}" method="post">{% csrf_token %}
              {% for field in actionForm %}

                {% if not field.is_hidden %}
                  <div class="form_item_wrapper, form_item_wrapper_actionform" id="id_{{ field.name }}_wrapper">
                    <div class="errorlist_wrapper">{{ field.errors|safe }}</div>
                    <label for="{{ field.id_for_label }}" class="label_actionform">{{ field.label }}:</label>
                    {{ field }}
                  </div>
                {% else %}
                    {{ field }}
                {% endif %}

              {% endfor %}
            
              <input id="id_actionFormSubmitButton_withoutConfirm"
                     type="submit" class="submitbutton_actionform" name="Action" value="Perform Action"/>
              <input id="id_actionFormSubmitButton_withConfirm"
                     type="submit" class="submitbutton_actionform" name="Action" value="Perform Action"/>
            </form>

            <!-- Script in the body will run on page load. -->
            <script type="text/javascript">
                ImageBatchActionFormHelper.init({{ images.paginator.count }});
            </script>
        {% endif %}

    {% endif %}

{% endblock %}
