{% extends "images/base_image.html" %}
{% load i18n %}
{% load guardian_tags %}
{% load dajaxice_templatetags %}

{% block title %}Annotation Tool | CoralNet{% endblock %}

{% block media-includes %}
    {{ block.super }}
    {% dajaxice_js_import %}
    <script src="/static/js/util.js" type="text/javascript"></script>
    <script src="/static/js/AnnotationToolHelper.js" type="text/javascript"></script>
{% endblock %}

{% block css-code %}
<style type="text/css">

/* For the image and canvas, use position:absolute
 * and make their positions the same (default of 0,0).  This'll make
 * them overlap.  Use z-index to determine which "layers" are on
 * top or bottom.  Also, the surrounding div must have
 * position:relative so that the image and canvas don't overlap
 * the rest of the page elements.
 */

#annotationArea {
    position: relative;
}

#coralImage {
    position: absolute;
}

#pointsCanvas {
    position: absolute;
}

#listenerElmt {
    position: absolute;
}

#labelButtons button {
    width: 80px;
}

#mainColumn {
    float: left;

    /* Spilling beyond 1000px height is fine, but we define as 1000px
       so this takes up space, thus forcing the rightSidebar to
       stay on the right. */
    width: 850px;
    height: 1000px;
}

#rightSidebar {
    float: left;
    width: 130px;
    height: 1000px;
}

#dummyColumn {
    height: 1000px;
}

#annotationList {
    /* scrollbars will appear if they're necessary */
    overflow: auto;
    height: 800px;
}

#annotationForm {
    width: auto;
    margin: auto;
    padding: 0;
}

#annotationForm input {
    margin: 1px 0;
    padding: 1px 1px;
}

#annotationForm tr.selected span.annotationFormLabel {
    background-color: #CCFFCC;
}

#annotationForm tr.robot input {
    color: #888888;
}

#annotationForm tr.error input {
    background-color: #FFCCCC;
}

.annotationFormLabel {
    padding: 0 3px;
    margin: 0 2px;
    border: 1px solid #D7D7D7;
    cursor: default;
}

td.annotationFormLabelCell {
    text-align: right;
}

</style>
{% endblock %}

{% block content %}

<p>Image: {{ metadata.name }}</p>
<p>Location keys: {{ location_values|default:"(Unknown)" }}</p>
<p>Year: {{ metadata.photo_date.year|default:"(Unknown)" }}</p>
<p>Annotation point type: {{ image.point_gen_method_display }}</p>
<p>Annotation progress: {{ num_of_annotations }} of {{ num_of_points }} points done</p>

<div>
    <div id="mainColumn">
      <div id="annotationArea">

        <!-- The coral image  -->
        <img id="coralImage" src="{{ image.original_file.url }}" />

        <!-- HTML5 canvas element for drawing points -->
        <canvas id="pointsCanvas"></canvas>

        <!-- Dummy element for listening to mouseclicks, etc. -->
        <div id="listenerElmt"></div>
      </div>

      <div id="labelButtons">
        {% for code in labelCodes %}
            <button>{{ code }}</button>
        {% endfor %}
      </div>
    </div>

    <div id="rightSidebar">

     <form id="annotationForm"
          action="" method="post">{% csrf_token %}

      {% for field in form.hidden_fields %}
          {{ field }}
      {% endfor %}

      <div id="annotationList">

        <table>

        {% for field in form.visible_fields %}
          <tr>
            <td class="annotationFormLabelCell">
                <span class="annotationFormLabel">{{ field.label }}</span>
            </td>
            <td>
                {{ field }}
            </td>
          </tr>
        {% endfor %}
        
        </table>

      </div>

      <!-- type="button" ensures that the button doesn't do a non-Ajax form submit -->
      <button id="saveButton" type="button">Save progress</button>

     </form>

    </div>

    <!--
    Column layouts work best when each column can float left - but at the same time,
    there needs to be one column at the end that doesn't float, so it can take up page space,
    which ensures that the page footer appears below everything.
    This column exists for this sole purpose.
    -->
    <div id="dummyColumn"></div>

</div>

<!-- Script in the body will run on page load. -->
<script type="text/javascript">
    AnnotationToolHelper.init({{ initial_display_height }},
                              {{ initial_display_width }},
                              {{ image.original_height }},
                              {{ image.original_width }},
                              {{ annotationsJSON|safe }},
                              {{ labelCodesJSON|safe }});
</script>

{% endblock %}
